<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin - Respuestas Staff</title>

  <style>
    body { font-family: Arial, Helvetica, sans-serif; background:#071023; color:#eef; padding:18px; }
    .wrap { max-width:1000px; margin:12px auto; }
    .top { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .card { background:#0d1722; padding:12px; border-radius:8px; margin-top:12px; box-shadow:0 6px 18px rgba(0,0,0,0.6); }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:12px; margin-top:12px; }
    h1{ margin:0; }
    input, button { padding:8px 10px; border-radius:6px; border:1px solid #123; background:#071423; color:#fff; }
    button { background:#0ea5a4; cursor:pointer; }
    .small{ color:#99a; font-size:13px; }
    .meta{ color:#9bd; font-size:13px; margin-top:6px; }
    .logout { background:#ef4444; color:#fff; border:none; padding:8px 10px; border-radius:6px; cursor:pointer; }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onValue, query, orderByChild } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // === CONFIG: pega TU config (o usa variables)
    const firebaseConfig = {
      apiKey: "AIzaSyAbkpn2i02BQ4EdbxPRmjMTiJb_U32noZA",
      authDomain: "respuestas-a0c38.firebaseapp.com",
      databaseURL: "https://respuestas-a0c38-default-rtdb.firebaseio.com",
      projectId: "respuestas-a0c38",
      storageBucket: "respuestas-a0c38.firebasestorage.app",
      messagingSenderId: "694006707121",
      appId: "1:694006707121:web:79267ca0496b935bd88390",
      measurementId: "G-FLNG6V9KMK"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- LOGIN SIMPLE (cliente) ---
    const ADMIN_USER = "admin";
    const ADMIN_PASS = "staff2025"; // cambia esto a algo que recuerdes

    function setLoggedIn(val) {
      if (val) localStorage.setItem("admin_logged", "1");
      else localStorage.removeItem("admin_logged");
      render();
    }

    function isLoggedIn() {
      return localStorage.getItem("admin_logged") === "1";
    }

    // --- RENDER UI ---
    function render() {
      const root = document.getElementById("root");
      if (!isLoggedIn()) {
        root.innerHTML = `
          <div class="card">
            <h2>ðŸ”’ Login Admin</h2>
            <p class="small">Introduce usuario y contraseÃ±a.</p>
            <div style="margin-top:10px">
              <input id="u" placeholder="Usuario" /><br/><br/>
              <input id="p" placeholder="ContraseÃ±a" type="password" /><br/><br/>
              <button id="loginBtn">Entrar</button>
              <p class="small" style="margin-top:8px">Usuario: <b>${ADMIN_USER}</b> - Clave: <b>${ADMIN_PASS}</b></p>
            </div>
          </div>
        `;
        document.getElementById("loginBtn").onclick = () => {
          const u = document.getElementById("u").value.trim();
          const p = document.getElementById("p").value.trim();
          if (u === ADMIN_USER && p === ADMIN_PASS) {
            setLoggedIn(true);
          } else {
            alert("Credenciales incorrectas");
          }
        };
        return;
      }

      // Si estÃ¡ logueado, mostramos panel y botÃ³n logout
      root.innerHTML = `
        <div class="top">
          <div>
            <h1>ðŸ“‹ Respuestas del Staff</h1>
            <div class="small">ConexiÃ³n: <span id="status">conectando...</span></div>
          </div>
          <div>
            <button id="logoutBtn" class="logout">Cerrar sesiÃ³n</button>
          </div>
        </div>
        <div id="list" class="grid" style="margin-top:12px"></div>
      `;

      document.getElementById("logoutBtn").onclick = () => setLoggedIn(false);

      // Escuchar la DB
      const respuestasRef = ref(db, "respuestas");
      onValue(respuestasRef, (snap) => {
        const data = snap.val();
        const list = document.getElementById("list");
        document.getElementById("status").textContent = "conectado";
        list.innerHTML = "";

        if (!data) {
          list.innerHTML = `<div class="card">No hay respuestas todavÃ­a.</div>`;
          return;
        }

        // Mostrar en orden cronolÃ³gico aproximado (no garantizado)
        Object.entries(data).reverse().forEach(([key, r]) => {
          const el = document.createElement("div");
          el.className = "card";
          el.innerHTML = `
            <div><strong>${escapeHtml(r.nombre || "â€”")}</strong> <span class="meta">(${r.edad || "â€”"} aÃ±os â€” ${escapeHtml(r.pais || "â€”")})</span></div>
            <div style="margin-top:8px"><b>Experiencia:</b><div>${nl2br(escapeHtml(r.experiencia || ""))}</div></div>
            <div style="margin-top:8px"><b>Motivo:</b><div>${nl2br(escapeHtml(r.motivo || ""))}</div></div>
            <div class="meta" style="margin-top:8px">Enviado: ${r.fecha ? new Date(r.fecha).toLocaleString() : "â€”"}</div>
          `;
          list.appendChild(el);
        });
      }, (err) => {
        document.getElementById("status").textContent = "error";
        console.error("DB error:", err);
      });
    }

    // util helpers
    function escapeHtml(s) {
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }
    function nl2br(s) { return s.replaceAll(/\n/g, "<br/>"); }

    // start
    window.addEventListener("DOMContentLoaded", () => render());
  </script>
</head>
<body>
  <div class="wrap">
    <div id="root"></div>
  </div>
</body>
</html>
